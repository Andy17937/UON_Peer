<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æµ‹è¯• Preset Questions ä¿å­˜</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-group { margin: 15px 0; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        textarea { min-height: 100px; }
        button { padding: 10px 20px; background: #4299e1; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #3182ce; }
        .result { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æµ‹è¯• Preset Questions ä¿å­˜åŠŸèƒ½</h1>
    
    <div class="form-group">
        <label>ID (ç•™ç©ºåˆ›å»ºæ–°è®°å½•ï¼Œå¡«å†™IDæ›´æ–°ç°æœ‰è®°å½•):</label>
        <input type="text" id="id" value="20" placeholder="ä¾‹å¦‚: 20">
    </div>
    
    <div class="form-group">
        <label>Category:</label>
        <input type="text" id="category" value="courses" required>
    </div>
    
    <div class="form-group">
        <label>Category Icon:</label>
        <input type="text" id="category_icon" value="ğŸ“š">
    </div>
    
    <div class="form-group">
        <label>Category Name (ä¸­æ–‡):</label>
        <input type="text" id="category_name_zh" value="è¯¾ç¨‹æµ‹è¯•" required>
    </div>
    
    <div class="form-group">
        <label>Category Name (English):</label>
        <input type="text" id="category_name_en" value="Courses Test" required>
    </div>
    
    <div class="form-group">
        <label>Questions (ä¸­æ–‡) - æ¯è¡Œä¸€ä¸ªé—®é¢˜:</label>
        <textarea id="questions_zh">å¦‚ä½•æŸ¥çœ‹è¯¾ç¨‹è¡¨ï¼Ÿ
å¦‚ä½•ç”³è¯·è°ƒè¯¾ï¼Ÿ
æœŸæœ«è€ƒè¯•æ—¶é—´å®‰æ’
è¿™æ˜¯æµ‹è¯•æ–°å¢çš„é—®é¢˜</textarea>
    </div>
    
    <div class="form-group">
        <label>Questions (English) - æ¯è¡Œä¸€ä¸ªé—®é¢˜:</label>
        <textarea id="questions_en">How to check course schedules?
How to apply for course changes?
Final exam schedule
This is a test new question</textarea>
    </div>
    
    <div class="form-group">
        <label>Sort Order:</label>
        <input type="number" id="sort_order" value="2">
    </div>
    
    <div class="form-group">
        <label>
            <input type="checkbox" id="is_active" checked> Active
        </label>
    </div>
    
    <button onclick="testSave()">ğŸ’¾ ä¿å­˜</button>
    <button onclick="checkDatabase()">ğŸ” æŸ¥çœ‹æ•°æ®åº“</button>
    
    <h2>ç»“æœ:</h2>
    <div id="result"></div>
    
    <script>
        async function testSave() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>æ­£åœ¨ä¿å­˜...</p>';
            
            try {
                const formData = new FormData();
                formData.append('action', 'preset_questions');
                formData.append('method', 'save');
                
                const id = document.getElementById('id').value;
                if (id) formData.append('data[id]', id);
                
                formData.append('data[category]', document.getElementById('category').value);
                formData.append('data[category_icon]', document.getElementById('category_icon').value);
                formData.append('data[category_name_zh]', document.getElementById('category_name_zh').value);
                formData.append('data[category_name_en]', document.getElementById('category_name_en').value);
                formData.append('data[questions_zh]', document.getElementById('questions_zh').value);
                formData.append('data[questions_en]', document.getElementById('questions_en').value);
                formData.append('data[sort_order]', document.getElementById('sort_order').value);
                
                if (document.getElementById('is_active').checked) {
                    formData.append('data[is_active]', '1');
                }
                
                console.log('å‘é€æ•°æ®...');
                const response = await fetch('/api/admin-config.php', {
                    method: 'POST',
                    body: formData
                });
                
                console.log('å“åº”çŠ¶æ€:', response.status);
                const text = await response.text();
                console.log('å“åº”å†…å®¹:', text);
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>âŒ è§£æé”™è¯¯</h3>
                            <p>æ— æ³•è§£æ JSON å“åº”</p>
                            <pre>${text}</pre>
                        </div>
                    `;
                    return;
                }
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>âœ… ä¿å­˜æˆåŠŸï¼</h3>
                            <p><strong>æ¶ˆæ¯:</strong> ${data.message || 'Success'}</p>
                            <p><strong>ID:</strong> ${data.id || id || 'N/A'}</p>
                            <p>ç°åœ¨å¯ä»¥ç‚¹å‡» "æŸ¥çœ‹æ•°æ®åº“" éªŒè¯æ•°æ®æ˜¯å¦çœŸçš„ä¿å­˜äº†ã€‚</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>âŒ ä¿å­˜å¤±è´¥</h3>
                            <p><strong>é”™è¯¯:</strong> ${data.error || data.message || 'Unknown error'}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('é”™è¯¯:', error);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>âŒ è¯·æ±‚å¤±è´¥</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function checkDatabase() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>æ­£åœ¨æŸ¥è¯¢æ•°æ®åº“...</p>';
            
            try {
                const id = document.getElementById('id').value || '20';
                const response = await fetch(`/api/admin-config.php?action=preset-questions`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    const record = data.data.find(r => r.id == id);
                    
                    if (record) {
                        const questionsZh = JSON.parse(record.questions_zh || '[]');
                        const questionsEn = JSON.parse(record.questions_en || '[]');
                        
                        resultDiv.innerHTML = `
                            <div class="result">
                                <h3>ğŸ“Š æ•°æ®åº“è®°å½• (ID: ${record.id})</h3>
                                <p><strong>Category:</strong> ${record.category}</p>
                                <p><strong>åç§°:</strong> ${record.category_name_zh} / ${record.category_name_en}</p>
                                <p><strong>å›¾æ ‡:</strong> ${record.category_icon}</p>
                                <p><strong>æ’åº:</strong> ${record.sort_order}</p>
                                <p><strong>çŠ¶æ€:</strong> ${record.is_active ? 'âœ… Active' : 'âŒ Inactive'}</p>
                                <p><strong>æ›´æ–°æ—¶é—´:</strong> ${record.updated_at}</p>
                                <p><strong>ä¸­æ–‡é—®é¢˜ (${questionsZh.length}):</strong></p>
                                <ol>${questionsZh.map(q => `<li>${q}</li>`).join('')}</ol>
                                <p><strong>è‹±æ–‡é—®é¢˜ (${questionsEn.length}):</strong></p>
                                <ol>${questionsEn.map(q => `<li>${q}</li>`).join('')}</ol>
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <div class="result error">
                                <h3>âŒ æœªæ‰¾åˆ°è®°å½•</h3>
                                <p>ID ${id} çš„è®°å½•ä¸å­˜åœ¨</p>
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>âŒ æŸ¥è¯¢å¤±è´¥</h3>
                            <p>${data.error || 'Unknown error'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>âŒ æŸ¥è¯¢å¤±è´¥</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æŸ¥çœ‹å½“å‰æ•°æ®åº“çŠ¶æ€
        window.onload = checkDatabase;
    </script>
</body>
</html>

