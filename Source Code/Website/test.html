<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿæµ‹è¯• | å­¦ç”Ÿé—®ç­”ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .test-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .test-button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            display: none;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .loading {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .test-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pending { background: #ffc107; }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
        
        <h1>ğŸ”§ ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            è¿™ä¸ªé¡µé¢å¯ä»¥å¸®åŠ©æ‚¨æµ‹è¯•å­¦ç”Ÿé—®ç­”ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
        </p>
        
        <!-- æ•°æ®åº“è¿æ¥æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending" id="db-status"></span>
                1. æ•°æ®åº“è¿æ¥æµ‹è¯•
            </div>
            <p>æµ‹è¯•æ•°æ®åº“è¿æ¥å’ŒåŸºç¡€æŸ¥è¯¢åŠŸèƒ½</p>
            <button class="test-button" onclick="testDatabase()">æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
            <div class="test-result" id="db-result"></div>
        </div>
        
        <!-- API æ¥å£æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending" id="api-status"></span>
                2. API æ¥å£æµ‹è¯•
            </div>
            <p>æµ‹è¯•é—®ç­” API æ¥å£çš„åŸºæœ¬åŠŸèƒ½</p>
            <button class="test-button" onclick="testAPI()">æµ‹è¯•åŸºç¡€ API</button>
            <button class="test-button" onclick="testStats()">æµ‹è¯•ç»Ÿè®¡æ¥å£</button>
            <div class="test-result" id="api-result"></div>
        </div>
        
        <!-- é—®ç­”åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending" id="keyword-status"></span>
                3. é—®ç­”åŠŸèƒ½æµ‹è¯•
            </div>
            <p>æµ‹è¯•ä¸åŒç±»å‹é—®é¢˜çš„é—®ç­”å›å¤åŠŸèƒ½</p>
            <button class="test-button" onclick="testKeywords()">æµ‹è¯•é—®ç­”åŠŸèƒ½</button>
            <div class="test-result" id="keyword-result"></div>
        </div>
        
        <!-- å¿ƒç†å¥åº·æ£€æµ‹æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending" id="psychology-status"></span>
                4. å¿ƒç†å¥åº·æ£€æµ‹æµ‹è¯•
            </div>
            <p>æµ‹è¯•å¿ƒç†å¥åº·ç›¸å…³é—®é¢˜çš„æ£€æµ‹å’Œé¢„è­¦åŠŸèƒ½</p>
            <button class="test-button" onclick="testPsychology()">æµ‹è¯•å¿ƒç†å¥åº·æ£€æµ‹</button>
            <div class="test-result" id="psychology-result"></div>
        </div>
        
        <!-- å¤šè¯­è¨€æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending" id="language-status"></span>
                5. å¤šè¯­è¨€æ”¯æŒæµ‹è¯•
            </div>
            <p>æµ‹è¯•ä¸­è‹±æ–‡é—®é¢˜çš„å¤„ç†å’Œå›å¤</p>
            <button class="test-button" onclick="testLanguages()">æµ‹è¯•å¤šè¯­è¨€æ”¯æŒ</button>
            <div class="test-result" id="language-result"></div>
        </div>
        
        <!-- è‡ªå®šä¹‰æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-pending" id="custom-status"></span>
                6. è‡ªå®šä¹‰é—®é¢˜æµ‹è¯•
            </div>
            <p>è¾“å…¥è‡ªå®šä¹‰é—®é¢˜è¿›è¡Œæµ‹è¯•</p>
            <input type="text" class="test-input" id="custom-question" placeholder="è¯·è¾“å…¥æµ‹è¯•é—®é¢˜..." maxlength="500">
            <button class="test-button" onclick="testCustomQuestion()">å‘é€æµ‹è¯•é—®é¢˜</button>
            <div class="test-result" id="custom-result"></div>
        </div>
        
        <!-- å…¨é¢æµ‹è¯• -->
        <div class="test-section" style="text-align: center;">
            <button class="test-button" onclick="runAllTests()" style="background: #28a745; font-size: 1.1rem; padding: 15px 30px;">
                ğŸš€ è¿è¡Œå…¨éƒ¨æµ‹è¯•
            </button>
        </div>
    </div>
    
    <script>
        // æµ‹è¯•å·¥å…·ç±»
        class SystemTester {
            constructor() {
                this.baseURL = window.location.origin + window.location.pathname.replace('test.html', '');
                this.results = {};
            }
            
            async makeRequest(url, options = {}) {
                try {
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        ...options
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    throw new Error(`è¯·æ±‚å¤±è´¥: ${error.message}`);
                }
            }
            
            showResult(elementId, content, type = 'info') {
                const element = document.getElementById(elementId);
                element.className = `test-result ${type}`;
                element.textContent = content;
                element.style.display = 'block';
                
                // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
                const statusId = elementId.replace('-result', '-status');
                const statusElement = document.getElementById(statusId);
                if (statusElement) {
                    statusElement.className = `status-indicator status-${type === 'success' ? 'success' : 'error'}`;
                }
            }
            
            async testDatabase() {
                this.showResult('db-result', 'æ­£åœ¨æµ‹è¯•æ•°æ®åº“è¿æ¥...', 'loading');
                
                try {
                    const result = await this.makeRequest('api/questions.php?action=test');
                    
                    if (result.success) {
                        this.showResult('db-result', 
                            `âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼\nè¿æ¥ä¿¡æ¯: ${result.message}\nå­—ç¬¦é›†: ${result.charset || 'æœªçŸ¥'}`, 
                            'success'
                        );
                        this.results.database = true;
                    } else {
                        this.showResult('db-result', 
                            `âŒ æ•°æ®åº“è¿æ¥å¤±è´¥\né”™è¯¯: ${result.error}`, 
                            'error'
                        );
                        this.results.database = false;
                    }
                } catch (error) {
                    this.showResult('db-result', 
                        `âŒ æ•°æ®åº“æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, 
                        'error'
                    );
                    this.results.database = false;
                }
            }
            
            async testAPI() {
                this.showResult('api-result', 'æ­£åœ¨æµ‹è¯• API æ¥å£...', 'loading');
                
                try {
                    // æµ‹è¯•é—®é¢˜æäº¤
                    const testQuestion = {
                        question: "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é—®é¢˜",
                        language: "zh"
                    };
                    
                    const result = await this.makeRequest('api/questions.php', {
                        method: 'POST',
                        body: JSON.stringify(testQuestion)
                    });
                    
                    if (result.success) {
                        this.showResult('api-result', 
                            `âœ… API æ¥å£æ­£å¸¸ï¼\né—®é¢˜ID: ${result.question_id}\nå›å¤: ${result.response}\nè¯­è¨€: ${result.language}`, 
                            'success'
                        );
                        this.results.api = true;
                    } else {
                        this.showResult('api-result', 
                            `âŒ API æ¥å£å¼‚å¸¸\né”™è¯¯: ${result.error}`, 
                            'error'
                        );
                        this.results.api = false;
                    }
                } catch (error) {
                    this.showResult('api-result', 
                        `âŒ API æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, 
                        'error'
                    );
                    this.results.api = false;
                }
            }
            
            async testStats() {
                try {
                    const stats = await this.makeRequest('api/questions.php?action=stats');
                    
                    if (stats.success) {
                        const current = document.getElementById('api-result');
                        current.textContent += `\n\nğŸ“Š ç»Ÿè®¡æ•°æ®è·å–æˆåŠŸ:\næ€»é—®é¢˜æ•°: ${stats.stats.total_questions}\nä»Šæ—¥é—®é¢˜: ${stats.stats.today_questions}\nå¿ƒç†å¥åº·ç›¸å…³: ${stats.stats.psychology_questions}\nç‹¬ç«‹ç”¨æˆ·: ${stats.stats.unique_sessions}`;
                    }
                } catch (error) {
                    console.warn('ç»Ÿè®¡æ¥å£æµ‹è¯•å¤±è´¥:', error);
                }
            }
            
            async testKeywords() {
                this.showResult('keyword-result', 'æ­£åœ¨æµ‹è¯•é—®ç­”åŠŸèƒ½...', 'loading');
                
                const testCases = [
                    { question: "å®¿èˆå‡ ç‚¹å…³é—¨ï¼Ÿ", category: "å®¿èˆç®¡ç†" },
                    { question: "å›¾ä¹¦é¦†å¼€æ”¾æ—¶é—´", category: "å›¾ä¹¦é¦†" },
                    { question: "æ€ä¹ˆæŸ¥æˆç»©ï¼Ÿ", category: "æˆç»©æŸ¥è¯¢" },
                    { question: "é£Ÿå ‚ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ", category: "é£Ÿå ‚ä¿¡æ¯" },
                    { question: "What time does the library open?", category: "Library" }
                ];
                
                try {
                    let results = "é—®ç­”åŠŸèƒ½æµ‹è¯•ç»“æœ:\n";
                    let successCount = 0;
                    
                    for (const testCase of testCases) {
                        try {
                            const result = await this.makeRequest('api/questions.php', {
                                method: 'POST',
                                body: JSON.stringify(testCase)
                            });
                            
                                            if (result.success && result.response) {
                    results += `\nâœ… "${testCase.question}"\n   å›å¤: ${result.response.substring(0, 50)}...\n   åˆ†ç±»: ${result.category}`;
                    successCount++;
                } else {
                    results += `\nâš ï¸ "${testCase.question}"\n   å¤„ç†å¤±è´¥`;
                }
                        } catch (error) {
                            results += `\nâŒ "${testCase.question}"\n   æµ‹è¯•å¤±è´¥: ${error.message}`;
                        }
                    }
                    
                    results += `\n\næ€»ç»“: ${successCount}/${testCases.length} ä¸ªæµ‹è¯•ç”¨ä¾‹é€šè¿‡`;
                    
                    this.showResult('keyword-result', results, successCount >= testCases.length * 0.8 ? 'success' : 'error');
                    this.results.keywords = successCount >= testCases.length * 0.8;
                    
                } catch (error) {
                    this.showResult('keyword-result', 
                        `âŒ é—®ç­”åŠŸèƒ½æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, 
                        'error'
                    );
                    this.results.keywords = false;
                }
            }
            
            async testPsychology() {
                this.showResult('psychology-result', 'æ­£åœ¨æµ‹è¯•å¿ƒç†å¥åº·æ£€æµ‹...', 'loading');
                
                const psychologyQuestions = [
                    "æˆ‘æ„Ÿè§‰å¾ˆæŠ‘éƒ",
                    "æœ€è¿‘æ€»æ˜¯å¾ˆç„¦è™‘",
                    "I feel very depressed",
                    "æˆ‘éœ€è¦å¿ƒç†å’¨è¯¢",
                    "ç¡ä¸ç€è§‰å¾ˆç—›è‹¦"
                ];
                
                try {
                    let results = "å¿ƒç†å¥åº·æ£€æµ‹æµ‹è¯•ç»“æœ:\n";
                    let detectedCount = 0;
                    
                    for (const question of psychologyQuestions) {
                        try {
                            const result = await this.makeRequest('api/questions.php', {
                                method: 'POST',
                                body: JSON.stringify({ question, language: 'zh' })
                            });
                            
                            if (result.success && result.is_psychology_related) {
                                results += `\nâœ… "${question}" - æ­£ç¡®æ£€æµ‹ä¸ºå¿ƒç†å¥åº·ç›¸å…³`;
                                detectedCount++;
                            } else {
                                results += `\nâŒ "${question}" - æœªæ£€æµ‹ä¸ºå¿ƒç†å¥åº·ç›¸å…³`;
                            }
                        } catch (error) {
                            results += `\nâŒ "${question}" - æµ‹è¯•å¤±è´¥: ${error.message}`;
                        }
                    }
                    
                    results += `\n\næ£€æµ‹å‡†ç¡®ç‡: ${detectedCount}/${psychologyQuestions.length}`;
                    
                    this.showResult('psychology-result', results, detectedCount >= psychologyQuestions.length * 0.8 ? 'success' : 'error');
                    this.results.psychology = detectedCount >= psychologyQuestions.length * 0.8;
                    
                } catch (error) {
                    this.showResult('psychology-result', 
                        `âŒ å¿ƒç†å¥åº·æ£€æµ‹æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, 
                        'error'
                    );
                    this.results.psychology = false;
                }
            }
            
            async testLanguages() {
                this.showResult('language-result', 'æ­£åœ¨æµ‹è¯•å¤šè¯­è¨€æ”¯æŒ...', 'loading');
                
                const languageTests = [
                    { question: "å›¾ä¹¦é¦†å‡ ç‚¹å¼€é—¨ï¼Ÿ", expectedLang: 'zh' },
                    { question: "What time does the library open?", expectedLang: 'en' },
                    { question: "å®¿èˆç®¡ç†", expectedLang: 'zh' },
                    { question: "dormitory hours", expectedLang: 'en' }
                ];
                
                try {
                    let results = "å¤šè¯­è¨€æ”¯æŒæµ‹è¯•ç»“æœ:\n";
                    let correctCount = 0;
                    
                    for (const test of languageTests) {
                        try {
                            const result = await this.makeRequest('api/questions.php', {
                                method: 'POST',
                                body: JSON.stringify({ question: test.question })
                            });
                            
                            if (result.success && result.language === test.expectedLang) {
                                results += `\nâœ… "${test.question}" - è¯­è¨€æ£€æµ‹æ­£ç¡® (${result.language})`;
                                correctCount++;
                            } else {
                                results += `\nâŒ "${test.question}" - è¯­è¨€æ£€æµ‹é”™è¯¯\n   æœŸæœ›: ${test.expectedLang}, å®é™…: ${result.language || 'æœªçŸ¥'}`;
                            }
                        } catch (error) {
                            results += `\nâŒ "${test.question}" - æµ‹è¯•å¤±è´¥: ${error.message}`;
                        }
                    }
                    
                    results += `\n\nè¯­è¨€æ£€æµ‹å‡†ç¡®ç‡: ${correctCount}/${languageTests.length}`;
                    
                    this.showResult('language-result', results, correctCount >= languageTests.length * 0.75 ? 'success' : 'error');
                    this.results.languages = correctCount >= languageTests.length * 0.75;
                    
                } catch (error) {
                    this.showResult('language-result', 
                        `âŒ å¤šè¯­è¨€æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, 
                        'error'
                    );
                    this.results.languages = false;
                }
            }
            
            async testCustomQuestion() {
                const question = document.getElementById('custom-question').value.trim();
                
                if (!question) {
                    this.showResult('custom-result', 'è¯·è¾“å…¥æµ‹è¯•é—®é¢˜', 'error');
                    return;
                }
                
                this.showResult('custom-result', 'æ­£åœ¨å¤„ç†è‡ªå®šä¹‰é—®é¢˜...', 'loading');
                
                try {
                    const result = await this.makeRequest('api/questions.php', {
                        method: 'POST',
                        body: JSON.stringify({ question })
                    });
                    
                    if (result.success) {
                        const resultText = `âœ… é—®é¢˜å¤„ç†æˆåŠŸï¼\n\né—®é¢˜: ${question}\nå›å¤: ${result.response}\nè¯­è¨€: ${result.language}\nåˆ†ç±»: ${result.category}\nå¿ƒç†å¥åº·ç›¸å…³: ${result.is_psychology_related ? 'æ˜¯' : 'å¦'}\né—®é¢˜ID: ${result.question_id}`;
                        
                        this.showResult('custom-result', resultText, 'success');
                    } else {
                        this.showResult('custom-result', 
                            `âŒ é—®é¢˜å¤„ç†å¤±è´¥\né”™è¯¯: ${result.error}`, 
                            'error'
                        );
                    }
                } catch (error) {
                    this.showResult('custom-result', 
                        `âŒ è‡ªå®šä¹‰é—®é¢˜æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, 
                        'error'
                    );
                }
            }
            
            async runAllTests() {
                console.log('å¼€å§‹è¿è¡Œå…¨éƒ¨æµ‹è¯•...');
                
                // é‡ç½®ç»“æœ
                this.results = {};
                
                // ä¾æ¬¡è¿è¡Œæ‰€æœ‰æµ‹è¯•
                await this.testDatabase();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await this.testAPI();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await this.testKeywords();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await this.testPsychology();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await this.testLanguages();
                
                // æ˜¾ç¤ºæ€»ç»“
                this.showTestSummary();
            }
            
            showTestSummary() {
                const passedTests = Object.values(this.results).filter(result => result === true).length;
                const totalTests = Object.keys(this.results).length;
                
                let summaryText = `\n\nğŸ¯ æµ‹è¯•å®Œæˆæ€»ç»“:\né€šè¿‡æµ‹è¯•: ${passedTests}/${totalTests}\n`;
                
                for (const [test, passed] of Object.entries(this.results)) {
                    summaryText += `${passed ? 'âœ…' : 'âŒ'} ${test}\n`;
                }
                
                if (passedTests === totalTests) {
                    summaryText += '\nğŸ‰ æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†ï¼ç³»ç»Ÿè¿è¡Œæ­£å¸¸ã€‚';
                } else if (passedTests >= totalTests * 0.8) {
                    summaryText += '\nâš ï¸ å¤§éƒ¨åˆ†æµ‹è¯•é€šè¿‡ï¼Œç³»ç»ŸåŸºæœ¬æ­£å¸¸ï¼Œä½†æœ‰äº›åŠŸèƒ½éœ€è¦æ£€æŸ¥ã€‚';
                } else {
                    summaryText += '\nâŒ å¤šä¸ªæµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç³»ç»Ÿé…ç½®å’Œæ•°æ®åº“è¿æ¥ã€‚';
                }
                
                // æ˜¾ç¤ºåœ¨æœ€åä¸€ä¸ªæµ‹è¯•ç»“æœä¸­
                const lastResult = document.querySelector('.test-result[style*="block"]:last-of-type') || 
                                 document.getElementById('language-result');
                if (lastResult) {
                    lastResult.textContent += summaryText;
                }
            }
        }
        
        // åˆ›å»ºå…¨å±€æµ‹è¯•å™¨å®ä¾‹
        const tester = new SystemTester();
        
        // å…¨å±€æµ‹è¯•å‡½æ•°
        function testDatabase() { tester.testDatabase(); }
        function testAPI() { tester.testAPI(); }
        function testStats() { tester.testStats(); }
        function testKeywords() { tester.testKeywords(); }
        function testPsychology() { tester.testPsychology(); }
        function testLanguages() { tester.testLanguages(); }
        function testCustomQuestion() { tester.testCustomQuestion(); }
        function runAllTests() { tester.runAllTests(); }
        
        // è‡ªå®šä¹‰é—®é¢˜è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document.getElementById('custom-question').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testCustomQuestion();
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•æ•°æ®åº“è¿æ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç³»ç»Ÿæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            // è‡ªåŠ¨è¿›è¡Œæ•°æ®åº“è¿æ¥æµ‹è¯•
            setTimeout(() => {
                testDatabase();
            }, 1000);
        });
    </script>
</body>
</html> 