<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿè¯Šæ–­å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        .btn {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #667eea;
            color: white;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            font-size: 13px;
            line-height: 1.8;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .warning { color: #f59e0b; font-weight: bold; }
        .info { color: #3b82f6; font-weight: bold; }
        pre {
            background: #282c34;
            color: #abb2bf;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            margin-top: 10px;
        }
        .fix-btn {
            background: #10b981;
        }
        .fix-btn:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ASK Uon ç³»ç»Ÿè¯Šæ–­å·¥å…·</h1>
        
        <div class="section">
            <h2>ğŸ“‹ åŸºç¡€æ£€æŸ¥</h2>
            <button class="btn" onclick="checkBasics()">è¿è¡ŒåŸºç¡€æ£€æŸ¥</button>
            <button class="btn" onclick="checkFiles()">æ£€æŸ¥æ–‡ä»¶åŠ è½½</button>
            <button class="btn" onclick="checkStorage()">æ£€æŸ¥æœ¬åœ°å­˜å‚¨</button>
            <div class="result" id="basic-result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥...</div>
        </div>

        <div class="section">
            <h2>ğŸ­ å¯¹è¯æ¡†æµ‹è¯•</h2>
            <button class="btn" onclick="testDialogs()">æµ‹è¯•å¯¹è¯æ¡†æ˜¾ç¤º</button>
            <button class="btn" onclick="testCSS()">æµ‹è¯•CSSåŠ è½½</button>
            <button class="btn" onclick="testJS()">æµ‹è¯•JSåŠŸèƒ½</button>
            <div class="result" id="dialog-result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>

        <div class="section">
            <h2>ğŸ”¨ å¿«é€Ÿä¿®å¤</h2>
            <button class="btn fix-btn" onclick="clearCache()">æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</button>
            <button class="btn fix-btn" onclick="resetLocalStorage()">é‡ç½®æœ¬åœ°å­˜å‚¨</button>
            <button class="btn fix-btn" onclick="forceReload()">å¼ºåˆ¶é‡æ–°åŠ è½½</button>
            <div class="result" id="fix-result">ç‚¹å‡»æŒ‰é’®æ‰§è¡Œä¿®å¤æ“ä½œ...</div>
        </div>

        <div class="section">
            <h2>ğŸ“Š ç³»ç»Ÿä¿¡æ¯</h2>
            <button class="btn" onclick="showSystemInfo()">æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯</button>
            <div class="result" id="system-result">ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯...</div>
        </div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString('zh-CN');
            const icon = {
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ï¸',
                'info': 'â„¹ï¸'
            }[type] || 'â„¹ï¸';
            
            const line = `<span class="${type}">${icon} [${timestamp}] ${message}</span><br>`;
            element.innerHTML += line;
            element.scrollTop = element.scrollHeight;
        }

        function clearResult(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        async function checkBasics() {
            clearResult('basic-result');
            log('basic-result', 'å¼€å§‹åŸºç¡€æ£€æŸ¥...', 'info');
            
            // æ£€æŸ¥æµè§ˆå™¨
            log('basic-result', `æµè§ˆå™¨: ${navigator.userAgent}`, 'info');
            log('basic-result', `è¯­è¨€: ${navigator.language}`, 'info');
            log('basic-result', `åœ¨çº¿çŠ¶æ€: ${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}`, navigator.onLine ? 'success' : 'error');
            
            // æ£€æŸ¥Cookie
            const cookieEnabled = navigator.cookieEnabled;
            log('basic-result', `Cookie: ${cookieEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, cookieEnabled ? 'success' : 'error');
            
            // æ£€æŸ¥LocalStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                log('basic-result', 'LocalStorage: å¯ç”¨', 'success');
            } catch (e) {
                log('basic-result', `LocalStorage: ä¸å¯ç”¨ (${e.message})`, 'error');
            }
            
            // æ£€æŸ¥é¡µé¢å…ƒç´ 
            const elements = [
                { id: 'student-id-modal', name: 'å­¦ç”ŸIDå¯¹è¯æ¡†' },
                { id: 'psychology-modal', name: 'å¿ƒç†å¥åº·å¯¹è¯æ¡†' },
                { id: 'question-form', name: 'é—®é¢˜è¡¨å•' },
                { id: 'chat-history', name: 'èŠå¤©å†å²' }
            ];
            
            elements.forEach(elem => {
                const el = document.getElementById(elem.id);
                if (el) {
                    log('basic-result', `${elem.name}: å­˜åœ¨`, 'success');
                } else {
                    log('basic-result', `${elem.name}: ä¸å­˜åœ¨`, 'error');
                }
            });
            
            log('basic-result', 'åŸºç¡€æ£€æŸ¥å®Œæˆ', 'success');
        }

        async function checkFiles() {
            clearResult('basic-result');
            log('basic-result', 'æ£€æŸ¥æ–‡ä»¶åŠ è½½...', 'info');
            
            // æ£€æŸ¥CSS
            const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
            log('basic-result', `æ‰¾åˆ° ${stylesheets.length} ä¸ªCSSæ–‡ä»¶`, 'info');
            
            for (let i = 0; i < stylesheets.length; i++) {
                const link = stylesheets[i];
                try {
                    const response = await fetch(link.href, { method: 'HEAD' });
                    if (response.ok) {
                        log('basic-result', `CSS ${i+1}: ${link.href} - åŠ è½½æˆåŠŸ`, 'success');
                    } else {
                        log('basic-result', `CSS ${i+1}: ${link.href} - åŠ è½½å¤±è´¥ (${response.status})`, 'error');
                    }
                } catch (e) {
                    log('basic-result', `CSS ${i+1}: ${link.href} - åŠ è½½é”™è¯¯ (${e.message})`, 'error');
                }
            }
            
            // æ£€æŸ¥JS
            const scripts = document.querySelectorAll('script[src]');
            log('basic-result', `æ‰¾åˆ° ${scripts.length} ä¸ªJSæ–‡ä»¶`, 'info');
            
            for (let i = 0; i < scripts.length; i++) {
                const script = scripts[i];
                if (script.src) {
                    try {
                        const response = await fetch(script.src, { method: 'HEAD' });
                        if (response.ok) {
                            log('basic-result', `JS ${i+1}: ${script.src} - åŠ è½½æˆåŠŸ`, 'success');
                        } else {
                            log('basic-result', `JS ${i+1}: ${script.src} - åŠ è½½å¤±è´¥ (${response.status})`, 'error');
                        }
                    } catch (e) {
                        log('basic-result', `JS ${i+1}: ${script.src} - åŠ è½½é”™è¯¯ (${e.message})`, 'error');
                    }
                }
            }
            
            log('basic-result', 'æ–‡ä»¶æ£€æŸ¥å®Œæˆ', 'success');
        }

        function checkStorage() {
            clearResult('basic-result');
            log('basic-result', 'æ£€æŸ¥æœ¬åœ°å­˜å‚¨...', 'info');
            
            try {
                const keys = Object.keys(localStorage);
                log('basic-result', `LocalStorage ä¸­æœ‰ ${keys.length} ä¸ªé¡¹ç›®`, 'info');
                
                keys.forEach(key => {
                    const value = localStorage.getItem(key);
                    const size = new Blob([value]).size;
                    log('basic-result', `${key}: ${size} bytes`, 'info');
                    
                    if (key === 'qa-app-state') {
                        try {
                            const data = JSON.parse(value);
                            log('basic-result', `  - è¯­è¨€: ${data.language || 'N/A'}`, 'info');
                            log('basic-result', `  - å­¦ç”ŸID: ${data.studentId || 'N/A'}`, 'info');
                            log('basic-result', `  - å·²éªŒè¯: ${data.isStudentVerified ? 'æ˜¯' : 'å¦'}`, data.isStudentVerified ? 'success' : 'warning');
                            log('basic-result', `  - é—®é¢˜æ•°: ${data.questionCount || 0}`, 'info');
                        } catch (e) {
                            log('basic-result', `  - è§£æé”™è¯¯: ${e.message}`, 'error');
                        }
                    }
                });
                
                log('basic-result', 'å­˜å‚¨æ£€æŸ¥å®Œæˆ', 'success');
            } catch (e) {
                log('basic-result', `æ£€æŸ¥å­˜å‚¨æ—¶å‡ºé”™: ${e.message}`, 'error');
            }
        }

        function testDialogs() {
            clearResult('dialog-result');
            log('dialog-result', 'å¼€å§‹å¯¹è¯æ¡†æµ‹è¯•...', 'info');
            
            // æ£€æŸ¥å¯¹è¯æ¡†å…ƒç´ 
            const studentModal = document.getElementById('student-id-modal');
            const psychModal = document.getElementById('psychology-modal');
            
            if (!studentModal) {
                log('dialog-result', 'å­¦ç”ŸIDå¯¹è¯æ¡†å…ƒç´ ä¸å­˜åœ¨ï¼', 'error');
            } else {
                log('dialog-result', 'å­¦ç”ŸIDå¯¹è¯æ¡†å…ƒç´ å­˜åœ¨', 'success');
                
                // æ£€æŸ¥CSSç±»
                log('dialog-result', `å½“å‰ç±»: ${studentModal.className}`, 'info');
                
                // æ£€æŸ¥è®¡ç®—æ ·å¼
                const style = window.getComputedStyle(studentModal);
                log('dialog-result', `display: ${style.display}`, 'info');
                log('dialog-result', `z-index: ${style.zIndex}`, 'info');
                log('dialog-result', `position: ${style.position}`, 'info');
                
                // å°è¯•æ˜¾ç¤º
                log('dialog-result', 'å°è¯•æ·»åŠ  active ç±»...', 'info');
                studentModal.classList.add('active');
                
                setTimeout(() => {
                    const newStyle = window.getComputedStyle(studentModal);
                    log('dialog-result', `æ·»åŠ å display: ${newStyle.display}`, newStyle.display === 'flex' ? 'success' : 'error');
                    
                    if (newStyle.display === 'flex') {
                        log('dialog-result', 'âœ… å¯¹è¯æ¡†æ˜¾ç¤ºæˆåŠŸï¼', 'success');
                        setTimeout(() => {
                            studentModal.classList.remove('active');
                            log('dialog-result', 'å¯¹è¯æ¡†å·²å…³é—­', 'info');
                        }, 3000);
                    } else {
                        log('dialog-result', 'âŒ å¯¹è¯æ¡†æ— æ³•æ˜¾ç¤ºï¼å¯èƒ½æ˜¯CSSé—®é¢˜', 'error');
                    }
                }, 100);
            }
            
            if (!psychModal) {
                log('dialog-result', 'å¿ƒç†å¥åº·å¯¹è¯æ¡†å…ƒç´ ä¸å­˜åœ¨ï¼', 'error');
            } else {
                log('dialog-result', 'å¿ƒç†å¥åº·å¯¹è¯æ¡†å…ƒç´ å­˜åœ¨', 'success');
            }
        }

        function testCSS() {
            clearResult('dialog-result');
            log('dialog-result', 'æµ‹è¯•CSSæ ·å¼...', 'info');
            
            // åˆ›å»ºæµ‹è¯•å…ƒç´ 
            const testDiv = document.createElement('div');
            testDiv.className = 'modal-overlay';
            testDiv.style.position = 'absolute';
            testDiv.style.left = '-9999px';
            document.body.appendChild(testDiv);
            
            const style = window.getComputedStyle(testDiv);
            log('dialog-result', `modal-overlay display: ${style.display}`, 'info');
            log('dialog-result', `modal-overlay z-index: ${style.zIndex}`, 'info');
            
            // æ·»åŠ activeç±»æµ‹è¯•
            testDiv.classList.add('active');
            const activeStyle = window.getComputedStyle(testDiv);
            log('dialog-result', `modal-overlay.active display: ${activeStyle.display}`, activeStyle.display === 'flex' ? 'success' : 'error');
            
            document.body.removeChild(testDiv);
            
            // æ£€æŸ¥CSSå˜é‡
            const root = document.documentElement;
            const rootStyle = window.getComputedStyle(root);
            log('dialog-result', `--primary-gradient: ${rootStyle.getPropertyValue('--primary-gradient') || 'æœªå®šä¹‰'}`, 'info');
            
            log('dialog-result', 'CSSæµ‹è¯•å®Œæˆ', 'success');
        }

        function testJS() {
            clearResult('dialog-result');
            log('dialog-result', 'æµ‹è¯•JavaScriptåŠŸèƒ½...', 'info');
            
            // æ£€æŸ¥å…¨å±€å¯¹è±¡
            if (typeof window.qaApp !== 'undefined') {
                log('dialog-result', 'qaApp å¯¹è±¡å­˜åœ¨', 'success');
                log('dialog-result', `  - state: ${window.qaApp.state ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, 'info');
                log('dialog-result', `  - ui: ${window.qaApp.ui ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, 'info');
                log('dialog-result', `  - api: ${window.qaApp.api ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, 'info');
                
                if (window.qaApp.state) {
                    log('dialog-result', `  - å½“å‰è¯­è¨€: ${window.qaApp.state.currentLanguage}`, 'info');
                    log('dialog-result', `  - å­¦ç”ŸID: ${window.qaApp.state.studentId || 'N/A'}`, 'info');
                    log('dialog-result', `  - å·²éªŒè¯: ${window.qaApp.state.isStudentVerified}`, 'info');
                }
            } else {
                log('dialog-result', 'qaApp å¯¹è±¡ä¸å­˜åœ¨ï¼JavaScriptå¯èƒ½æœªåŠ è½½', 'error');
            }
            
            // æ£€æŸ¥jQueryï¼ˆå¦‚æœä½¿ç”¨ï¼‰
            log('dialog-result', `jQuery: ${typeof $ !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}`, 'info');
            
            log('dialog-result', 'JavaScriptæµ‹è¯•å®Œæˆ', 'success');
        }

        function clearCache() {
            clearResult('fix-result');
            log('fix-result', 'æ¸…é™¤æµè§ˆå™¨ç¼“å­˜...', 'info');
            
            // æ¸…é™¤Service Workerç¼“å­˜
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    for (let registration of registrations) {
                        registration.unregister();
                        log('fix-result', 'Service Workerå·²å¸è½½', 'success');
                    }
                });
            }
            
            // æ¸…é™¤Cache API
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                        log('fix-result', `ç¼“å­˜ ${name} å·²æ¸…é™¤`, 'success');
                    });
                });
            }
            
            log('fix-result', 'ç¼“å­˜æ¸…é™¤å®Œæˆï¼Œè¯·æŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°é¡µé¢', 'success');
        }

        function resetLocalStorage() {
            clearResult('fix-result');
            log('fix-result', 'é‡ç½®æœ¬åœ°å­˜å‚¨...', 'info');
            
            const keys = Object.keys(localStorage);
            log('fix-result', `å‘ç° ${keys.length} ä¸ªå­˜å‚¨é¡¹ç›®`, 'info');
            
            keys.forEach(key => {
                localStorage.removeItem(key);
                log('fix-result', `å·²åˆ é™¤: ${key}`, 'success');
            });
            
            log('fix-result', 'æœ¬åœ°å­˜å‚¨å·²é‡ç½®ï¼Œè¯·åˆ·æ–°é¡µé¢', 'success');
        }

        function forceReload() {
            clearResult('fix-result');
            log('fix-result', 'å‡†å¤‡å¼ºåˆ¶é‡æ–°åŠ è½½...', 'info');
            log('fix-result', '3ç§’åå°†é‡æ–°åŠ è½½é¡µé¢...', 'warning');
            
            setTimeout(() => {
                window.location.href = '/index.html?_t=' + Date.now();
            }, 3000);
        }

        function showSystemInfo() {
            clearResult('system-result');
            log('system-result', 'ç³»ç»Ÿä¿¡æ¯:', 'info');
            
            const info = {
                'æµè§ˆå™¨': navigator.userAgent,
                'å¹³å°': navigator.platform,
                'è¯­è¨€': navigator.language,
                'åœ¨çº¿': navigator.onLine,
                'Cookie': navigator.cookieEnabled,
                'å±å¹•': `${screen.width}x${screen.height}`,
                'è§†å£': `${window.innerWidth}x${window.innerHeight}`,
                'æ—¶åŒº': Intl.DateTimeFormat().resolvedOptions().timeZone,
                'å†…å­˜': navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'N/A',
                'CPUæ ¸å¿ƒ': navigator.hardwareConcurrency || 'N/A',
                'è¿æ¥ç±»å‹': navigator.connection ? navigator.connection.effectiveType : 'N/A'
            };
            
            for (const [key, value] of Object.entries(info)) {
                log('system-result', `${key}: ${value}`, 'info');
            }
            
            // æ˜¾ç¤ºæ€§èƒ½ä¿¡æ¯
            if (performance.timing) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                log('system-result', `é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`, 'info');
            }
            
            log('system-result', 'ç³»ç»Ÿä¿¡æ¯æ˜¾ç¤ºå®Œæˆ', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.addEventListener('load', function() {
            console.log('è¯Šæ–­å·¥å…·å·²åŠ è½½');
        });
    </script>
</body>
</html>

